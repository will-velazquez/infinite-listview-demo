<Page
    x:Class="Fantastical.App.Pages.SegmentedCrashTest"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:toolkit="using:CommunityToolkit.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:local="using:Fantastical.Core"
    x:Name="foo">
    <FrameworkElement.Resources>
        <Style TargetType="controls:Segmented">
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <local:EqualPanel_Patched
                            HorizontalAlignment="{Binding (toolkit:FrameworkElementExtensions.Ancestor).HorizontalAlignment, RelativeSource={RelativeSource Mode=Self}}"
                            toolkit:FrameworkElementExtensions.AncestorType="controls:Segmented"
                             />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </FrameworkElement.Resources>
    <StackPanel Orientation="Vertical">
        <ItemsRepeater ItemsSource="{x:Bind Numbers}">
            <ItemsRepeater.ItemTemplate>
                <DataTemplate x:DataType="x:Int32">
                    <TextBlock Foreground="{Binding Color, ElementName=.}" Text="{x:Bind}" />
                </DataTemplate>
            </ItemsRepeater.ItemTemplate>
        </ItemsRepeater>
        <controls:Segmented
                SelectionMode="Single"
                SelectedIndex="0">
            <controls:SegmentedItem Content="Foo" />
            <controls:SegmentedItem Content="Bar" />
            <controls:SegmentedItem Content="Baz" />
        </controls:Segmented>
        <NavigationView
            IsBackButtonVisible="Collapsed"
            IsSettingsVisible="False"
            IsBackEnabled="False"
            PaneDisplayMode="Top"
            HorizontalAlignment="Left"
            PaneCustomContent="{x:Null}"
            Background="Red"
             >
            <FrameworkElement.Resources>
                <ResourceDictionary>
                    <x:Double x:Key="NavigationBackButtonWidth">0</x:Double>
                    <x:Double x:Key="TopNavigationViewPaneCustomContentMinWidth">0</x:Double>
                </ResourceDictionary>
            </FrameworkElement.Resources>
            <NavigationView.MenuItems>
                <NavigationViewItem Content="Foo" />
                <NavigationViewItem Content="Bar" />
                <NavigationViewItem Content="Baz" />
            </NavigationView.MenuItems>
        </NavigationView>

    </StackPanel>
</Page>
